#!/usr/bin/env node
require("babel/register"); // don't put anything above this line!

// parse command line
var nopt = require("nopt")
  , Stream = require("stream").Stream
  , path = require("path")
    , knownOpts = { "phrase" : [String, null]
                , "mem" : Number
                , "time" : Number
                , "file" : [String, Array]
                , "storm" : Boolean
                }
  , shortHands = { "p" : ["--phrase"]
                 , "m" : ["--mem"]
                 , "t" : ["--time"]
                 , "f" : ["--file"]
                 , "s" : ["--storm"]
                 }
  , parsed = nopt(knownOpts, shortHands, process.argv, 2)

if(parsed.storm) {
	require("./storm.js")
	process.exit();
}


if(!parsed.file) {
  console.log('Specify file list with -f');
  process.exit();
}

var fs = require('fs')
var model = require('./src/model'),
  Board = model.Board,
  Unit = model.Unit,
  Game = model.Game;
var read = require('./src/reader');

var solution = [];
parsed.file.forEach(function(fileName, i, arr) {
	fs.readFile(fileName, function (err, data) {
                if (err) throw err;                
                task = JSON.parse(data);
                var game = read(task);
                var unit = new Unit(task.units[0].pivot, task.units[0].members);
                //console.log(unit);
                game.unit = game.spawn(game.board, unit);
                //game.display();

                var entry = {
                    problemId : task.id,
                    seed : task.sourceSeeds[0],
                    tag : 'first',
                    solution : 'amamamama'
                  };
                console.log(entry);
                solution.push(entry);



                // TODO: solve problem here
                
                
            });
});

console.log(JSON.stringify(solution));